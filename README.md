<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# ghit

```go
import "github.com/chg1f/ghit"
```

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [type Hitter](<#type-hitter>)
  - [func NewHitter(opt *HitterOption) (*Hitter, error)](<#func-newhitter>)
  - [func (h *Hitter) Background()](<#func-hitter-background>)
  - [func (h *Hitter) Close() error](<#func-hitter-close>)
  - [func (h *Hitter) Hit() (ok bool, err error)](<#func-hitter-hit>)
  - [func (h *Hitter) Hitted() int64](<#func-hitter-hitted>)
  - [func (h *Hitter) QPS() float64](<#func-hitter-qps>)
  - [func (h *Hitter) Sync(now time.Time) (next time.Time, err error)](<#func-hitter-sync>)
- [type HitterOption](<#type-hitteroption>)
- [type Node](<#type-node>)
  - [func NewNode(opt *NodeOption) (*Node, error)](<#func-newnode>)
  - [func (n *Node) Background()](<#func-node-background>)
  - [func (n *Node) Clean() error](<#func-node-clean>)
  - [func (n *Node) Close() error](<#func-node-close>)
  - [func (n *Node) Dead() error](<#func-node-dead>)
  - [func (n *Node) Heartbeat() error](<#func-node-heartbeat>)
  - [func (n *Node) NodeID() string](<#func-node-nodeid>)
  - [func (n *Node) NodeIDs() ([]string, error)](<#func-node-nodeids>)
- [type NodeOption](<#type-nodeoption>)


## Constants

```go
const (
    DefaultNodesKeySuffix = "NODES"
    DefaultNodeExpire     = time.Hour
)
```

## Variables

```go
var (
    EnableLimit = true

    DefaultKeyQPSSuffix = ":QPS"
)
```

```go
var (
    NodeID string
)
```

## type Hitter

```go
type Hitter struct {
    *Node
    // contains filtered or unexported fields
}
```

<details><summary>Example</summary>
<p>

```go
{
	hitter, err := NewHitter(&HitterOption{
		NodeOption: &NodeOption{
			Redis:     redis.NewClient(&redis.Options{Addr: "localhost:6379"}),
			KeyPrefix: "ghit:",
		},
		ExpireSpec:     "@midnight",
		QPSShakeCoeff:  2,
		FollowInterval: time.Hour * 24,
		Key:            "run",
		EnableLimit:    true,
		Limit:          1,
	})
	if err != nil {
		panic(err)
	}
	defer hitter.Close()
	if ok, err := hitter.Hit(); err != nil {

	} else if !ok {
		return
	}
}
```

</p>
</details>

### func NewHitter

```go
func NewHitter(opt *HitterOption) (*Hitter, error)
```

### func \(\*Hitter\) Background

```go
func (h *Hitter) Background()
```

### func \(\*Hitter\) Close

```go
func (h *Hitter) Close() error
```

### func \(\*Hitter\) Hit

```go
func (h *Hitter) Hit() (ok bool, err error)
```

### func \(\*Hitter\) Hitted

```go
func (h *Hitter) Hitted() int64
```

### func \(\*Hitter\) QPS

```go
func (h *Hitter) QPS() float64
```

### func \(\*Hitter\) Sync

```go
func (h *Hitter) Sync(now time.Time) (next time.Time, err error)
```

## type HitterOption

```go
type HitterOption struct {
    *NodeOption

    ExpireSpec      string
    QPSShakeCoeff   float64
    EnableMaxSync   bool
    MaxSyncInterval time.Duration
    EnableMinSync   bool
    MinSyncInterval time.Duration
    FollowInterval  time.Duration

    Key             string
    KeyQPSSuffix    string
    KeySuffixFormat string

    EnableLimit bool
    Limit       int64
}
```

## type Node

```go
type Node struct {
    // contains filtered or unexported fields
}
```

<details><summary>Example</summary>
<p>

```go
{
	expireInterval := time.Hour
	node, err := NewNode(&NodeOption{
		Redis:          redis.NewClient(&redis.Options{Addr: "localhost:6379"}),
		KeyPrefix:      "ghit:",
		ExpireInterval: expireInterval,
	})
	if err != nil {
		panic(err)
	}
	defer node.Close()
	node.Heartbeat()
	defer node.Dead()
	for {
		select {
		case <-time.After(expireInterval):
			node.Heartbeat()
		}
	}
}
```

</p>
</details>

### func NewNode

```go
func NewNode(opt *NodeOption) (*Node, error)
```

### func \(\*Node\) Background

```go
func (n *Node) Background()
```

### func \(\*Node\) Clean

```go
func (n *Node) Clean() error
```

### func \(\*Node\) Close

```go
func (n *Node) Close() error
```

### func \(\*Node\) Dead

```go
func (n *Node) Dead() error
```

### func \(\*Node\) Heartbeat

```go
func (n *Node) Heartbeat() error
```

### func \(\*Node\) NodeID

```go
func (n *Node) NodeID() string
```

### func \(\*Node\) NodeIDs

```go
func (n *Node) NodeIDs() ([]string, error)
```

## type NodeOption

```go
type NodeOption struct {
    Redis          redis.Cmdable
    KeyPrefix      string
    NodesKeySuffix string
    NodeID         string
    ExpireInterval time.Duration
}
```

![test workflow](https://github.com/chg1f/ghit/actions/workflows/test.yml/badge.svg?branch=master)

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
